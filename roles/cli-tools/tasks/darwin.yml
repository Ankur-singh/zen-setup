---
- name: Install Homebrew (if not already installed)
  shell: |
    if ! command -v brew &> /dev/null; then
      /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    fi
  args:
    executable: /bin/bash
  changed_when: false

- name: Tap Homebrew repositories
  homebrew_tap:
    name: "{{ item }}"
    state: present
  loop: "{{ homebrew_taps }}"
  when: homebrew_taps is defined

- name: Install Homebrew packages
  homebrew:
    name: "{{ homebrew_packages }}"
    state: present
    update_homebrew: yes
  when: homebrew_packages is defined

- name: Install Homebrew Cask packages (fonts)
  homebrew_cask:
    name: "{{ homebrew_cask_packages }}"
    state: present
  when: homebrew_cask_packages is defined
  ignore_errors: yes

- name: Initialize fzf key bindings and fuzzy completion
  shell: |
    $(brew --prefix)/opt/fzf/install --key-bindings --completion --no-update-rc --no-bash
  args:
    executable: /bin/bash
    creates: "{{ ansible_env.HOME }}/.fzf.bash"

