---
- name: Include OS-specific Git tasks
  include_tasks: "{{ ansible_os_family | lower }}.yml"

- name: Configure Git user name
  git_config:
    name: user.name
    value: "{{ git_user_name }}"
    scope: global
  when: git_user_name is defined and git_user_name != ""

- name: Configure Git user email
  git_config:
    name: user.email
    value: "{{ git_user_email }}"
    scope: global
  when: git_user_email is defined and git_user_email != ""

- name: Configure Git default branch name
  git_config:
    name: init.defaultBranch
    value: main
    scope: global

- name: Configure Git pull strategy
  git_config:
    name: pull.rebase
    value: "false"
    scope: global

- name: Configure Git credential helper (macOS)
  git_config:
    name: credential.helper
    value: osxkeychain
    scope: global
  when: ansible_os_family == "Darwin"

- name: Configure Git credential helper (Linux)
  git_config:
    name: credential.helper
    value: cache --timeout=3600
    scope: global
  when: ansible_os_family == "Debian"

- name: Enable Git colors
  git_config:
    name: "{{ item }}"
    value: auto
    scope: global
  loop:
    - color.ui
    - color.branch
    - color.diff
    - color.status

- name: Configure useful Git aliases
  git_config:
    name: "alias.{{ item.key }}"
    value: "{{ item.value }}"
    scope: global
  loop:
    - { key: "st", value: "status" }
    - { key: "co", value: "checkout" }
    - { key: "br", value: "branch" }
    - { key: "ci", value: "commit" }
    - { key: "unstage", value: "reset HEAD --" }
    - { key: "last", value: "log -1 HEAD" }
    - { key: "lg", value: "log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit" }
    - { key: "amend", value: "commit --amend --no-edit" }
    - { key: "undo", value: "reset --soft HEAD~1" }

- name: Display Git configuration message
  debug:
    msg: |
      Git configured!
      {% if git_user_name == "" or git_user_email == "" %}
      ⚠️  Remember to set your Git identity:
         git config --global user.name "Your Name"
         git config --global user.email "your@email.com"
      {% endif %}
      
      GitHub CLI (gh) is installed. Authenticate with:
         gh auth login

