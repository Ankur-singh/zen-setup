---
- name: Ensure Neovim is installed
  debug:
    msg: "Neovim should be installed via cli-tools role"

- name: Backup existing neovim config
  shell: |
    [ -d "{{ config_dir }}/nvim" ] && mv "{{ config_dir }}/nvim" "{{ config_dir }}/nvim.backup.$(date +%Y%m%d_%H%M%S)" || true
    [ -d "{{ local_share_dir }}/nvim" ] && mv "{{ local_share_dir }}/nvim" "{{ local_share_dir }}/nvim.backup.$(date +%Y%m%d_%H%M%S)" || true
  args:
    executable: /bin/bash
  changed_when: false

- name: Clone LazyVim starter
  git:
    repo: https://github.com/LazyVim/starter
    dest: "{{ config_dir }}/nvim"
    depth: 1
    version: main
  when: neovim_config_type == "lazyvim"

- name: Remove LazyVim .git directory
  file:
    path: "{{ config_dir }}/nvim/.git"
    state: absent
  when: neovim_config_type == "lazyvim"

- name: Create custom LazyVim config directory
  file:
    path: "{{ config_dir }}/nvim/lua/config"
    state: directory
    mode: '0755'
  when: neovim_config_type == "lazyvim"

- name: Create custom plugins directory
  file:
    path: "{{ config_dir }}/nvim/lua/plugins"
    state: directory
    mode: '0755'
  when: neovim_config_type == "lazyvim"

- name: Copy custom LazyVim options
  copy:
    src: lazyvim-options.lua
    dest: "{{ config_dir }}/nvim/lua/config/options.lua"
    mode: '0644'
  when: neovim_config_type == "lazyvim"

- name: Copy custom LazyVim keymaps
  copy:
    src: lazyvim-keymaps.lua
    dest: "{{ config_dir }}/nvim/lua/config/keymaps.lua"
    mode: '0644'
  when: neovim_config_type == "lazyvim"

- name: Display Neovim setup message
  debug:
    msg: |
      Neovim with LazyVim installed!
      - Run 'nvim' and LazyVim will automatically install plugins
      - Press 'Space' to see the leader key menu
      - Press ':Lazy' to manage plugins
      - Press ':Mason' to install LSP servers, formatters, and linters

